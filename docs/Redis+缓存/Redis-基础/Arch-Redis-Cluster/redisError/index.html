<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="{% details 相关代码 %} cluster.c
/* Return the pointer to the cluster node that is able to serve the command. * For the function to succeed the command should only target either: * * 1) A single key (even multiple times like LPOPRPUSH mylist mylist). * 2) Multiple keys in the same hash slot, while the slot is stable (no * resharding in progress). * * On success the function returns the node that is able to serve the request.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://www6v.github.io/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/Arch-Redis-Cluster/redisError/">
  <meta property="og:site_name" content="中间件">
  <meta property="og:title" content="Redis Error-MOVED和ASK指令">
  <meta property="og:description" content="{% details 相关代码 %} cluster.c
/* Return the pointer to the cluster node that is able to serve the command. * For the function to succeed the command should only target either: * * 1) A single key (even multiple times like LPOPRPUSH mylist mylist). * 2) Multiple keys in the same hash slot, while the slot is stable (no * resharding in progress). * * On success the function returns the node that is able to serve the request.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="website">
<title>Redis Error-MOVED和ASK指令 | 中间件</title>
<link rel="icon" href="/www6vMiddleware/favicon.png" >
<link rel="manifest" href="/www6vMiddleware/manifest.json">
<link rel="canonical" href="https://www6v.github.io/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/Arch-Redis-Cluster/redisError/">
<link rel="stylesheet" href="/www6vMiddleware/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css" integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin="anonymous">
  <script defer src="/www6vMiddleware/fuse.min.js"></script>
  <script defer src="/www6vMiddleware/en.search.min.3753a7d03f4e50bb4ae48d3532debf27a12b9a0e0cbf0f664126378098a9f5ed.js" integrity="sha256-N1On0D9OULtK5I01Mt6/J6Ermg4Mvw9mQSY3gJip9e0=" crossorigin="anonymous"></script>

  

<link rel="alternate" type="application/rss+xml" href="https://www6v.github.io/www6vMiddleware/docs/Redis+%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/Arch-Redis-Cluster/redisError/index.xml" title="中间件" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/www6vMiddleware/"><span>中间件</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-b13c95c069c614e8c16265f1c191a430" class="toggle"  />
    <label for="section-b13c95c069c614e8c16265f1c191a430" class="flex justify-between">
      <a role="button" class="">服务治理</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <span>Overview</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/Overview/resilience/" class="">弹力设计 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/Overview/microservice/" class="">微服务 总结</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/Overview/soaFeature/" class="">分布式服务框架功能</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>API Gateway</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/API-Gateway/apiGatawaySpringGateway/" class="">API 网关-SpringCloud Gateway</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/API-Gateway/apiGatawayApisix/" class="">API 网关-apisix</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/API-Gateway/apiGateway/" class="">API Gateway网关 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Config &amp; Discovery</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/ConfigDiscovery/soaDiscovery/" class="">服务发现</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/ConfigDiscovery/config/" class="">服务治理-分布式配置</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>负载均衡</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/loadBalance/loadBalance/" class="">负载均衡-算法 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/loadBalance/nginxOptimize/" class="">Nginx优化</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/loadBalance/nginx/" class="">Nginx总结 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>线程模型</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/threadModel/jsfThreadModel/" class="">京东服务框架JSF服务提供者线程模型</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>容错&amp;限流</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <span>容错</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/faultTolerant/faultTolerant/soaTolerateFramework/" class="">容错框架</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/faultTolerant/faultTolerant/soaTimeout/" class="">超时和重试 总结 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/faultTolerant/faultTolerant/soaTolerate/" class="">分布式服务框架 容错机制 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>限流</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/faultTolerant/throttle/ratelimitSentinel/" class="">流量治理-Sentinel</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/faultTolerant/throttle/ratelimit/" class="">限流-总结 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/faultTolerant/soaGracefulStart/" class="">优雅启动</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/faultTolerant/soaGracefulClose/" class="">优雅关闭</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Spring Cloud</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/Springcloud/springTransactionInvalid/" class="">Spring  Transaction  失效</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/Springcloud/springCloud/" class="">SpringCloud</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/Springcloud/springboot/" class="">SpringBoot</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/Springcloud/springTransaction/" class="">Spring事务</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Deploy</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/Deploy/deploy/" class="">部署升级 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/Deploy/apiGatewayGray/" class="">API 网关-灰度发布</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>安全</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/security/soaAuth/" class="">服务治理-鉴权</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/serviceGovernance/security/securityOAuth2/" class="">安全-OAuth2 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-619f87396da4f22c9e982ebbcfb80a1d" class="toggle"  />
    <label for="section-619f87396da4f22c9e982ebbcfb80a1d" class="flex justify-between">
      <a role="button" class="">消息系统</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <span>Overview</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/message/Overview/mq/" class="">消息中间件 总结 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/message/Overview/mqCompare/" class="">MQ总结(Kafka, Rocketmq, Rabbitmq) *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/message/Overview/mqOrdering/" class="">消息系统 顺序消息</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Kafka</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/message/Kafka/kafka/" class="">Kafka总结</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/message/Kafka/kafkaProducer/" class="">Kafka Producer生产者</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/message/Kafka/kafkaConsumer/" class="">Kafka消费者总结</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/message/Kafka/kafkaRebalance/" class="">Kafka消费者-Rebalance机制</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/message/Kafka/kafkaReliability/" class="">Kafka 可靠性总结</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/message/Kafka/kafkaIndex/" class="">Kafka 索引</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/message/Kafka/kafkaZeroCopy/" class="">Kafka-ZeroCopy</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/message/Kafka/kafkaController/" class="">Kafka Controller-控制器</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/message/Kafka/kafkaReplica/" class="">Kafka Replication-副本机制</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/message/Kafka/kafkaElection/" class="">Kafka 中的选主</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/message/Kafka/kafkaQ-A/" class="">Kafka  Q&amp;A</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/message/Kafka/kafkaTransaction/" class="">Kafka 幂等性和事务</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-c8ef6724255360cd9e1bb212713f9134" class="toggle"  />
    <label for="section-c8ef6724255360cd9e1bb212713f9134" class="flex justify-between">
      <a role="button" class="">关系型数据库</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <span>单机</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/RMDB/%E5%8D%95%E6%9C%BA/mysqlTransactionAndLock/" class="">MySQL 事务-隔离性 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/RMDB/%E5%8D%95%E6%9C%BA/mysqlUpdate/" class="">MySQL中的SQL更新语句</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/RMDB/%E5%8D%95%E6%9C%BA/mysqlReliability/" class="">MySQL的主从 高可用 容灾 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/RMDB/%E5%8D%95%E6%9C%BA/mysqlIndex/" class="">MySQL的索引和优化 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/RMDB/%E5%8D%95%E6%9C%BA/mysqlTransaction/" class="">MySQL事务-总结 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/RMDB/%E5%8D%95%E6%9C%BA/mysqlLog/" class="">MySQL Logs</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/RMDB/%E5%8D%95%E6%9C%BA/mysqlDeadLock/" class="">MySQL  锁和死锁</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/RMDB/%E5%8D%95%E6%9C%BA/mysqlMasterSlaveDelay/" class="">MySQL 主从延迟</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>分布式</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/RMDB/%E5%88%86%E5%B8%83%E5%BC%8F/distributedDatabase/" class="">分布式 数据库 总结 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/RMDB/%E5%88%86%E5%B8%83%E5%BC%8F/distributedDatabaseCompare/" class="">分布式 数据库 比较</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/RMDB/%E5%88%86%E5%B8%83%E5%BC%8F/tikvMVCCTransaction/" class="">TiKV Transaction-MVCC&#43;TSO</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/RMDB/%E5%88%86%E5%B8%83%E5%BC%8F/distributedDatabaseGlobalTime/" class="">分布式数据库-全局时钟</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/RMDB/%E5%88%86%E5%B8%83%E5%BC%8F/distributedDatabaseJoinQuery/" class="">数据库  关联查询</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/RMDB/%E5%88%86%E5%B8%83%E5%BC%8F/globalSecondaryIndex/" class="">全局二级索引-GSI</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-10fff53c331fc90701f5c89a3d268231" class="toggle" checked />
    <label for="section-10fff53c331fc90701f5c89a3d268231" class="flex justify-between">
      <a role="button" class="">Redis&#43;缓存</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <span>Redis 基础</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <span>overview</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/overview/redis/" class="">Redis 总结 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/overview/redisIO/" class="">Redis 的IO模型</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Arch &amp; Redis Cluster</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/Arch-Redis-Cluster/redisArch/" class="">Redis 架构 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/Arch-Redis-Cluster/redisError/" class="active">Redis Error-MOVED和ASK指令</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/Arch-Redis-Cluster/redisCluster/" class="">Redis Cluster</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/Arch-Redis-Cluster/redisClusterSpec/" class="">Redis Cluster Spec</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/Arch-Redis-Cluster/redisHA/" class="">Redis 集群  容灾（同城多活）</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>数据类型</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/redisRehash/" class="">Redis Rehash机制</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/redisDataStructure/" class="">Redis数据结构</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>事务</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/%E4%BA%8B%E5%8A%A1/redisTransaction/" class="">Redis 事务</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>持久化</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/%E6%8C%81%E4%B9%85%E5%8C%96/redisBothAofAndRDB/" class="">Redis 混合持久化</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/%E6%8C%81%E4%B9%85%E5%8C%96/redisReplica/" class="">Redis 主从复制 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/%E6%8C%81%E4%B9%85%E5%8C%96/redisAOF/" class="">Redis AOF</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/%E6%8C%81%E4%B9%85%E5%8C%96/rdb/" class="">Redis RDB源码</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/%E6%8C%81%E4%B9%85%E5%8C%96/aofRewrite/" class="">Redis AOF Rewrite</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/%E6%8C%81%E4%B9%85%E5%8C%96/redisRDB/" class="">Redis RDB</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>资源回收</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/%E8%B5%84%E6%BA%90%E5%9B%9E%E6%94%B6/redisLazyFree/" class="">Redis LazyFree</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/%E8%B5%84%E6%BA%90%E5%9B%9E%E6%94%B6/redisDelete/" class="">Redis 回收策略</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/%E8%B5%84%E6%BA%90%E5%9B%9E%E6%94%B6/redisLRU/" class="">Redis LRU算法</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>其他</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%9F%BA%E7%A1%80/%E5%85%B6%E4%BB%96/redisNVM/" class="">Redis NVM</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Redis 故障&amp;优化</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <span>常见问题</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E6%95%85%E9%9A%9C%E4%BC%98%E5%8C%96/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/redisBigKey/" class="">Redis 大Key *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E6%95%85%E9%9A%9C%E4%BC%98%E5%8C%96/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/redisOptimize/" class="">Redis 优化建议</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E6%95%85%E9%9A%9C%E4%BC%98%E5%8C%96/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/redisReliability-1/" class="">Redis雪崩、击穿、穿透 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E6%95%85%E9%9A%9C%E4%BC%98%E5%8C%96/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/redisDbConsistent/" class="">Redis和数据库之间的一致性</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E6%95%85%E9%9A%9C%E4%BC%98%E5%8C%96/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/redisSlowResponse/" class="">Redis 慢查询排查</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E6%95%85%E9%9A%9C%E4%BC%98%E5%8C%96/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/redisHotkey/" class="">Redis 热点Hotkey</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E6%95%85%E9%9A%9C%E4%BC%98%E5%8C%96/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/redisHitRate/" class="">Redis  命中率</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E6%95%85%E9%9A%9C%E4%BC%98%E5%8C%96/redisNodeId/" class="">Redis 集群扩容时NodeId问题</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Redis 应用</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%BA%94%E7%94%A8/redisUseCase/" class="">Redis 使用场景UseCase</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/Redis-%E5%BA%94%E7%94%A8/redisSLO/" class="">Redis SLO</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>缓存</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98/cacheConsistent/" class="">缓存 一致性 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98/cacheMultiLayer/" class="">多级缓存(cache)</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98/cacheSummary/" class="">缓存(cache)总结 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Redis&#43;%E7%BC%93%E5%AD%98/%E7%BC%93%E5%AD%98/cache/" class="">缓存(cache)机制</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-32f9dc03750c220286c7473819bce980" class="toggle"  />
    <label for="section-32f9dc03750c220286c7473819bce980" class="flex justify-between">
      <a role="button" class="">可观察性</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-dc8f2f5497ce4108befe4e476516f176" class="toggle"  />
    <label for="section-dc8f2f5497ce4108befe4e476516f176" class="flex justify-between">
      <a role="button" class="">Overview</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Observe/Overview/observabilityBuilding/" class="">可观测性-系统构建</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Observe/Overview/observability/" class="">可观测性 总结 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3043990ad08375eb7c9c6edfe028b695" class="toggle"  />
    <label for="section-3043990ad08375eb7c9c6edfe028b695" class="flex justify-between">
      <a role="button" class="">统一模型</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Observe/%E7%BB%9F%E4%B8%80%E6%A8%A1%E5%9E%8B/observabilityOpenTelemetry/" class="">可观测性-OpenTelemetry</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-84e728d84c21d229850e75585c894763" class="toggle"  />
    <label for="section-84e728d84c21d229850e75585c894763" class="flex justify-between">
      <a role="button" class="">Tracing</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Observe/Tracing/observabilityTracing/" class="">可观测性-Tracing</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Observe/Tracing/observabilitySkywalking/" class="">可观测性-Skywalking</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b7783e9af3c62e3b112dcbbc90d53981" class="toggle"  />
    <label for="section-b7783e9af3c62e3b112dcbbc90d53981" class="flex justify-between">
      <a role="button" class="">Metric</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Observe/Metric/observabilityPrometheusBiz/" class="">可观测性-Prometheus业务监控</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-096d1f91bb8cc7509e2398164079cfc3" class="toggle"  />
    <label for="section-096d1f91bb8cc7509e2398164079cfc3" class="flex justify-between">
      <a role="button" class="">Log</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/Observe/Log/observabilityLog/" class="">可观测性-Log</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-13a7e93d081a3f31bedaa6f5a5dbc6b9" class="toggle"  />
    <label for="section-13a7e93d081a3f31bedaa6f5a5dbc6b9" class="flex justify-between">
      <a role="button" class="">DAL</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/DAL/dbShardingPaging/" class="">分库分表-分页</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/DAL/dbReadWrite/" class="">数据库-读写分离</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/DAL/dbSharding/" class="">分库分表 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/DAL/mybatisInteceptor/" class="">Mybatis Plugin Inteceptor</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-8f9194d3152193bbfc8d905f93eb7238" class="toggle"  />
    <label for="section-8f9194d3152193bbfc8d905f93eb7238" class="flex justify-between">
      <a role="button" class="">分布式锁</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/redisDistKey/" class="">Redis 分布式锁</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/zookeeperDistributedLock/" class="">Zookeeper-分布式锁</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/distributedLock/" class="">分布式锁</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-35ef217d212df8f7f126510047a2ffcd" class="toggle"  />
    <label for="section-35ef217d212df8f7f126510047a2ffcd" class="flex justify-between">
      <a role="button" class="">其他</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/%E5%85%B6%E4%BB%96/transactionSeata/" class="">分布式事务-Seata *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/%E5%85%B6%E4%BB%96/event/" class="">事件 Event</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/%E5%85%B6%E4%BB%96/tomcat/" class="">Tomcat总结</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/%E5%85%B6%E4%BB%96/timedTask/" class="">延迟消息 时间轮</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/%E5%85%B6%E4%BB%96/id/" class="">分布式ID生成 发号器 *</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/%E5%85%B6%E4%BB%96/zookeeper/" class="">分布式协调-Zookeeper</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-d4607dec705229c566e3d7c05dcf0a7c" class="toggle"  />
    <label for="section-d4607dec705229c566e3d7c05dcf0a7c" class="flex justify-between">
      <a role="button" class="">网络</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/%E7%BD%91%E7%BB%9C/grpc/" class="">gRPC</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/www6vMiddleware/docs/%E7%BD%91%E7%BB%9C/https/" class="">HTTP和HTTPS总结</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/www6vMiddleware/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Redis Error-MOVED和ASK指令</h3>

  <label for="toc-control">
    
    <img src="/www6vMiddleware/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#总结">总结</a></li>
        <li><a href="#参考">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><p></p>
<!-- more -->
<p>{%   details  相关代码 %}
cluster.c</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#75715e">/* Return the pointer to the cluster node that is able to serve the command.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * For the function to succeed the command should only target either:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 1) A single key (even multiple times like LPOPRPUSH mylist mylist).
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 2) Multiple keys in the same hash slot, while the slot is stable (no
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *    resharding in progress).
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * On success the function returns the node that is able to serve the request.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * If the node is not &#39;myself&#39; a redirection must be perfomed. The kind of
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * redirection is specified setting the integer passed by reference
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * &#39;error_code&#39;, which will be set to CLUSTER_REDIR_ASK or
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * CLUSTER_REDIR_MOVED.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * When the node is &#39;myself&#39; &#39;error_code&#39; is set to CLUSTER_REDIR_NONE.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * If the command fails NULL is returned, and the reason of the failure is
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * provided via &#39;error_code&#39;, which will be set to:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * CLUSTER_REDIR_CROSS_SLOT if the request contains multiple keys that
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * don&#39;t belong to the same hash slot.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * CLUSTER_REDIR_UNSTABLE if the request contains multiple keys
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * belonging to the same slot, but the slot is not stable (in migration or
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * importing state, likely because a resharding is in progress).
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * CLUSTER_REDIR_DOWN_UNBOUND if the request addresses a slot which is
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * not bound to any node. In this case the cluster global state should be
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * already &#34;down&#34; but it is fragile to rely on the update of the global state,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * so we also handle it here.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * CLUSTER_REDIR_DOWN_STATE if the cluster is down but the user attempts to
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * execute a command that addresses one or more keys. */</span>
</span></span><span style="display:flex;"><span>clusterNode <span style="color:#f92672">*</span><span style="color:#a6e22e">getNodeByQuery</span>(client <span style="color:#f92672">*</span>c, <span style="color:#66d9ef">struct</span> redisCommand <span style="color:#f92672">*</span>cmd, robj <span style="color:#f92672">**</span>argv, <span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>hashslot, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>error_code) {
</span></span><span style="display:flex;"><span>    clusterNode <span style="color:#f92672">*</span>n <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>    robj <span style="color:#f92672">*</span>firstkey <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> multiple_keys <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    multiState <span style="color:#f92672">*</span>ms, _ms;
</span></span><span style="display:flex;"><span>    multiCmd mc;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> i, slot <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, migrating_slot <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, importing_slot <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, missing_keys <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* Allow any key to be set if a module disabled cluster redirections. */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (server.cluster_module_flags <span style="color:#f92672">&amp;</span> CLUSTER_MODULE_FLAG_NO_REDIRECTION)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> myself;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* Set error code optimistically for the base case. */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (error_code) <span style="color:#f92672">*</span>error_code <span style="color:#f92672">=</span> CLUSTER_REDIR_NONE;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* Modules can turn off Redis Cluster redirection: this is useful
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * when writing a module that implements a completely different
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * distributed system. */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* We handle all the cases as if they were EXEC commands, so we have
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * a common code path for everything */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (cmd<span style="color:#f92672">-&gt;</span>proc <span style="color:#f92672">==</span> execCommand) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/* If CLIENT_MULTI flag is not set EXEC is just going to return an
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         * error. */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>(c<span style="color:#f92672">-&gt;</span>flags <span style="color:#f92672">&amp;</span> CLIENT_MULTI)) <span style="color:#66d9ef">return</span> myself;
</span></span><span style="display:flex;"><span>        ms <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>c<span style="color:#f92672">-&gt;</span>mstate;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/* In order to have a single codepath create a fake Multi State
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         * structure if the client is not in MULTI/EXEC state, this way
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         * we have a single codepath below. */</span>
</span></span><span style="display:flex;"><span>        ms <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>_ms;
</span></span><span style="display:flex;"><span>        _ms.commands <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>mc;
</span></span><span style="display:flex;"><span>        _ms.count <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        mc.argv <span style="color:#f92672">=</span> argv;
</span></span><span style="display:flex;"><span>        mc.argc <span style="color:#f92672">=</span> argc;
</span></span><span style="display:flex;"><span>        mc.cmd <span style="color:#f92672">=</span> cmd;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* Check that all the keys are in the same hash slot, and obtain this
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * slot and the node associated. */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> ms<span style="color:#f92672">-&gt;</span>count; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">struct</span> redisCommand <span style="color:#f92672">*</span>mcmd;
</span></span><span style="display:flex;"><span>        robj <span style="color:#f92672">**</span>margv;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> margc, <span style="color:#f92672">*</span>keyindex, numkeys, j;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        mcmd <span style="color:#f92672">=</span> ms<span style="color:#f92672">-&gt;</span>commands[i].cmd;
</span></span><span style="display:flex;"><span>        margc <span style="color:#f92672">=</span> ms<span style="color:#f92672">-&gt;</span>commands[i].argc;
</span></span><span style="display:flex;"><span>        margv <span style="color:#f92672">=</span> ms<span style="color:#f92672">-&gt;</span>commands[i].argv;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        keyindex <span style="color:#f92672">=</span> <span style="color:#a6e22e">getKeysFromCommand</span>(mcmd,margv,margc,<span style="color:#f92672">&amp;</span>numkeys);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> numkeys; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            robj <span style="color:#f92672">*</span>thiskey <span style="color:#f92672">=</span> margv[keyindex[j]];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> thisslot <span style="color:#f92672">=</span> <span style="color:#a6e22e">keyHashSlot</span>((<span style="color:#66d9ef">char</span><span style="color:#f92672">*</span>)thiskey<span style="color:#f92672">-&gt;</span>ptr,
</span></span><span style="display:flex;"><span>                                       <span style="color:#a6e22e">sdslen</span>(thiskey<span style="color:#f92672">-&gt;</span>ptr));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (firstkey <span style="color:#f92672">==</span> NULL) {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">/* This is the first key we see. Check what is the slot
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                 * and node. */</span>
</span></span><span style="display:flex;"><span>                firstkey <span style="color:#f92672">=</span> thiskey;
</span></span><span style="display:flex;"><span>                slot <span style="color:#f92672">=</span> thisslot;
</span></span><span style="display:flex;"><span>                n <span style="color:#f92672">=</span> server.cluster<span style="color:#f92672">-&gt;</span>slots[slot];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">/* Error: If a slot is not served, we are in &#34;cluster down&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                 * state. However the state is yet to be updated, so this was
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                 * not trapped earlier in processCommand(). Report the same
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                 * error to the client. */</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">==</span> NULL) {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">getKeysFreeResult</span>(keyindex);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (error_code)
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">*</span>error_code <span style="color:#f92672">=</span> CLUSTER_REDIR_DOWN_UNBOUND;
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> NULL;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">/* If we are migrating or importing this slot, we need to check
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                 * if we have all the keys in the request (the only way we
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                 * can safely serve the request, otherwise we return a TRYAGAIN
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                 * error). To do so we set the importing/migrating state and
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                 * increment a counter for every missing key. */</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">==</span> myself <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>                    server.cluster<span style="color:#f92672">-&gt;</span>migrating_slots_to[slot] <span style="color:#f92672">!=</span> NULL)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    migrating_slot <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (server.cluster<span style="color:#f92672">-&gt;</span>importing_slots_from[slot] <span style="color:#f92672">!=</span> NULL) {
</span></span><span style="display:flex;"><span>                    importing_slot <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">/* If it is not the first key, make sure it is exactly
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                 * the same key as the first we saw. */</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">equalStringObjects</span>(firstkey,thiskey)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (slot <span style="color:#f92672">!=</span> thisslot) {
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">/* Error: multiple keys from different slots. */</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">getKeysFreeResult</span>(keyindex);
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">if</span> (error_code)
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">*</span>error_code <span style="color:#f92672">=</span> CLUSTER_REDIR_CROSS_SLOT;
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">return</span> NULL;
</span></span><span style="display:flex;"><span>                    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">/* Flag this request as one with multiple different
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                         * keys. */</span>
</span></span><span style="display:flex;"><span>                        multiple_keys <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/* Migarting / Improrting slot? Count keys we don&#39;t have. */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ((migrating_slot <span style="color:#f92672">||</span> importing_slot) <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">lookupKeyRead</span>(<span style="color:#f92672">&amp;</span>server.db[<span style="color:#ae81ff">0</span>],thiskey) <span style="color:#f92672">==</span> NULL)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                missing_keys<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">getKeysFreeResult</span>(keyindex);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* No key at all in command? then we can serve the request
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * without redirections or errors in all the cases. */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">==</span> NULL) <span style="color:#66d9ef">return</span> myself;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* Cluster is globally down but we got keys? We can&#39;t serve the request. */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (server.cluster<span style="color:#f92672">-&gt;</span>state <span style="color:#f92672">!=</span> CLUSTER_OK) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (error_code) <span style="color:#f92672">*</span>error_code <span style="color:#f92672">=</span> CLUSTER_REDIR_DOWN_STATE;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> NULL;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* Return the hashslot by reference. */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (hashslot) <span style="color:#f92672">*</span>hashslot <span style="color:#f92672">=</span> slot;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* MIGRATE always works in the context of the local node if the slot
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * is open (migrating or importing state). We need to be able to freely
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * move keys among instances in this case. */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ((migrating_slot <span style="color:#f92672">||</span> importing_slot) <span style="color:#f92672">&amp;&amp;</span> cmd<span style="color:#f92672">-&gt;</span>proc <span style="color:#f92672">==</span> migrateCommand)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> myself;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* If we don&#39;t have all the keys and we are migrating the slot, send
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * an ASK redirection. */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (migrating_slot <span style="color:#f92672">&amp;&amp;</span> missing_keys) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (error_code) <span style="color:#f92672">*</span>error_code <span style="color:#f92672">=</span> CLUSTER_REDIR_ASK;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> server.cluster<span style="color:#f92672">-&gt;</span>migrating_slots_to[slot];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* If we are receiving the slot, and the client correctly flagged the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * request as &#34;ASKING&#34;, we can serve the request. However if the request
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * involves multiple keys and we don&#39;t have them all, the only option is
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * to send a TRYAGAIN error. */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (importing_slot <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>        (c<span style="color:#f92672">-&gt;</span>flags <span style="color:#f92672">&amp;</span> CLIENT_ASKING <span style="color:#f92672">||</span> cmd<span style="color:#f92672">-&gt;</span>flags <span style="color:#f92672">&amp;</span> CMD_ASKING))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (multiple_keys <span style="color:#f92672">&amp;&amp;</span> missing_keys) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (error_code) <span style="color:#f92672">*</span>error_code <span style="color:#f92672">=</span> CLUSTER_REDIR_UNSTABLE;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> NULL;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> myself;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* Handle the read-only client case reading from a slave: if this
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * node is a slave and the request is about an hash slot our master
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * is serving, we can reply without redirection. */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (c<span style="color:#f92672">-&gt;</span>flags <span style="color:#f92672">&amp;</span> CLIENT_READONLY <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>        (cmd<span style="color:#f92672">-&gt;</span>flags <span style="color:#f92672">&amp;</span> CMD_READONLY <span style="color:#f92672">||</span> cmd<span style="color:#f92672">-&gt;</span>proc <span style="color:#f92672">==</span> evalCommand <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>         cmd<span style="color:#f92672">-&gt;</span>proc <span style="color:#f92672">==</span> evalShaCommand) <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">nodeIsSlave</span>(myself) <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>        myself<span style="color:#f92672">-&gt;</span>slaveof <span style="color:#f92672">==</span> n)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> myself;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* Base case: just return the right node. However if this node is not
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * myself, set error_code to MOVED since we need to issue a rediretion. */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">!=</span> myself <span style="color:#f92672">&amp;&amp;</span> error_code) <span style="color:#f92672">*</span>error_code <span style="color:#f92672">=</span> CLUSTER_REDIR_MOVED;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> n;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>{%   enddetails   %}</p>
<p>代码展示了 getNodeByQuery 函数基本执行过程</p>
<p><img src="./images/moved.jpg" alt="moved" /></p>
<h2 id="总结">
  总结
  <a class="anchor" href="#%e6%80%bb%e7%bb%93">#</a>
</h2>
<p>Redis Cluster 会因为负载均衡或节点故障等原因而执行数据迁移，而</p>
<p>这就会导致客户端访问的 key 并不在接收到命令的集群节点上。因此，集群节点在命令执</p>
<p>行函数 processCommand 中，针对集群模式，就增加了额外的处理逻辑。这主要是包括</p>
<p>调用 <strong>getNodeByQuery 函数</strong>查询访问的 key 实际所属的节点，以及根据查询结果调用</p>
<p><strong>clusterRedirectClient 函数</strong>执行请求重定向。</p>
<p>事实上，对于分布式集群来说，Redis Cluster 设计实现的请求重定向机制是一个不错的参</p>
<p>考示例。其中，MOVED 和 ASK 两种重定向情况，就充分考虑了数据正在迁移的场景，这</p>
<p>种设计值得我们学习。而且，getNodeByQuery 函数在查询 key 所属的 slot 和节点时，</p>
<p>也充分考虑了 Redis 的事务操作，在对命令访问 key 进行查询时，巧妙地使用了<strong>同一个数</strong></p>
<p><strong>据结构 multiState</strong>，来封装事务涉及的多条命令和常规的单条命令，增加了代码的复用程</p>
<p>度，这一点也非常值得学习。</p>
<h2 id="参考">
  参考
  <a class="anchor" href="#%e5%8f%82%e8%80%83">#</a>
</h2>
<p>27 | 从MOVED、ASK看集群节点如何处理命令？  蒋德钧</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#总结">总结</a></li>
        <li><a href="#参考">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












